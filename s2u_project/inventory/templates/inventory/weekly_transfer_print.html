{% extends "inventory/base.html" %}

{% block title %}Transfer List · {{ order_list.store.name }}{% endblock %}

{% block extra_head %}
<style>
  @page {
    size: A4 portrait;
    margin: 12.7mm 11.43mm;
  }
  @media print {
    .no-print { display: none !important; }
    html, body { width: 210mm; background: #ffffff !important; }
    body { font-size: 11pt; }
    .container-xl { max-width: 187mm; }
    .card { box-shadow: none !important; border: none !important; }
    .transfer-table th, .transfer-table td {
      padding-top: 0.45rem;
      padding-bottom: 0.45rem;
      font-size: 10.5pt;
    }
    .transfer-table thead th { font-size: 11.5pt; }
  }
  body { font-size: 1.05rem; }
  .transfer-table {
    table-layout: fixed;
    border-collapse: collapse;
    width: 100%;
  }
  .transfer-table th, .transfer-table td {
    vertical-align: middle;
    font-size: 1.05rem;
    padding-top: 0.65rem;
    padding-bottom: 0.65rem;
    border: 1px solid #d0d7de;
  }
  .transfer-table thead th {
    font-size: 1.1rem;
    letter-spacing: 0.01em;
    background: #2563EB;
    color: #fff;
    text-align: center;
  }
  .transfer-table td:nth-child(2) { word-break: break-word; }
  .transfer-table tbody td:nth-child(1),
  .transfer-table tbody td:nth-child(3) { text-align: center; }
  .transfer-table tbody td:nth-child(4) { text-align: right; }
  .transfer-table colgroup col:nth-child(1) { width: 12.7%; }
  .transfer-table colgroup col:nth-child(2) { width: 55.2%; }
  .transfer-table colgroup col:nth-child(3) { width: 19.1%; }
  .transfer-table colgroup col:nth-child(4) { width: 13%; }
  .transfer-table tbody tr.store-row {
    background: var(--store-color, #f8fafc) !important;
  }
</style>
{% endblock %}

{% block content %}
<div class="container-xl py-4">
  <div class="d-flex justify-content-between align-items-center mb-3 no-print">
    <h1 class="h5 mb-0">
      <i class="bi bi-arrow-left-circle me-2"></i>
      <a href="{% url 'inventory:weekly_list_detail' order_list.id %}" class="text-decoration-none">Back to Weekly List</a>
    </h1>
    <button class="btn btn-primary" onclick="window.print()">
      <i class="bi bi-printer me-1"></i>Print
    </button>
  </div>

  <div class="card shadow-sm">
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-start mb-3">
        <div>
          <h2 class="h5 mb-1">Transfer List</h2>
          <div class="small text-muted">
            Store: {{ order_list.store.name }} ({{ order_list.store.number }})<br>
            Week of {{ order_list.target_date }}
          </div>
        </div>
        {% if order_list.finalized_at %}
        <div class="text-end small text-muted">
          Finalized: {{ order_list.finalized_at|date:"Y-m-d H:i" }}<br>
          {% if order_list.finalized_by %}
            By: {{ order_list.finalized_by.get_full_name|default:order_list.finalized_by.username }}
          {% endif %}
        </div>
        {% endif %}
      </div>

      {% if items %}
      <div class="table-responsive">
        <table class="table table-sm transfer-table">
          <colgroup>
            <col>
            <col>
            <col>
            <col>
          </colgroup>
          <thead class="table-light">
            <tr>
              <th scope="col">Product #</th>
              <th scope="col">Product Name</th>
              <th scope="col">From</th>
              <th scope="col">Bottles</th>
            </tr>
          </thead>
          <tbody>
            {% for item in items %}
            <tr class="store-row" style="--store-color: {{ item.row_color }}">
              <td>{{ item.product.number }}</td>
              <td>{{ item.product.name }}</td>
              <td>
                {% if item.transfer_from %}
                  #{{ item.transfer_from.number }}
                {% else %}
                  —
                {% endif %}
              </td>
              <td class="text-end">{{ item.transfer_bottles }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <div class="alert alert-info mb-0">
        <i class="bi bi-info-circle me-1"></i>No transfer items found for this list.
      </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
